import React, { useState, useEffect } from 'react';
import { Sparkles, Crown, Sword, Heart, Moon, Flame, Star } from 'lucide-react';

const PombagiraQuiz = () => {
  const [currentQuestion, setCurrentQuestion] = useState(0);
  const [score, setScore] = useState({});
  const [showResult, setShowResult] = useState(false);
  const [selectedAnswer, setSelectedAnswer] = useState(null);
  const [isCorrect, setIsCorrect] = useState(null);
  const [answeredQuestions, setAnsweredQuestions] = useState(0);

  const pombagiras = {
    'Maria Padilha': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/maria_padilha.png',
      cores: 'Vermelho, Dourado, Preto',
      dia: 'Sexta-feira',
      lua: 'Lua Cheia',
      signos: 'LeÃ£o, EscorpiÃ£o',
      simbologia: 'Coroa, Cetro, Espelho, Rosas Vermelhas',
      utensilio: 'Espada, Espelho, TaÃ§a de Cristal',
      mensagem: 'VocÃª carrega a energia do comando e da realeza! Maria Padilha te coroa como lÃ­der nata, sedutora e poderosa. Sua presenÃ§a comanda respeito e admiraÃ§Ã£o.'
    },
    'Maria Mulambo': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/maria_mulambo.png',
      cores: 'Branco, Verde-claro, Cinza',
      dia: 'Segunda ou Quarta-feira',
      lua: 'Lua Minguante',
      signos: 'Virgem, CÃ¢ncer',
      simbologia: 'Trapos Limpos, Vasos de Barro, Ervas',
      utensilio: 'Cesto de Vime, Moringa, Panos Brancos',
      mensagem: 'Sua alma Ã© pura e compassiva! Maria Mulambo te abenÃ§oa com o dom da cura e da humildade. VocÃª encontra beleza na simplicidade e forÃ§a na resiliÃªncia.'
    },
    'Maria QuitÃ©ria': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/maria_quiteria.png',
      cores: 'Vermelho, Marrom, Preto',
      dia: 'TerÃ§a-feira',
      lua: 'Lua Crescente',
      signos: 'Ãries, EscorpiÃ£o',
      simbologia: 'Espada, Escudo, Armadura, Bandeira',
      utensilio: 'Espada, FacÃ£o, Bandeira Vermelha',
      mensagem: 'VocÃª Ã© uma guerreira destemida! Maria QuitÃ©ria te protege nas batalhas da vida. Coragem, determinaÃ§Ã£o e proteÃ§Ã£o sÃ£o suas maiores armas.'
    },
    'Rosa Caveira': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/rosa_caveira.png',
      cores: 'Preto, Vermelho-sangue, Roxo',
      dia: 'SÃ¡bado',
      lua: 'Lua Nova ou Cheia',
      signos: 'EscorpiÃ£o, PlutÃ£o',
      simbologia: 'Caveira, Rosa, BalanÃ§a, Foice',
      utensilio: 'Foice, Espelho Preto, RosÃ¡rio de Ossos',
      mensagem: 'VocÃª compreende os ciclos da vida e morte! Rosa Caveira te guia na transformaÃ§Ã£o e justiÃ§a. Sua intensidade Ã© poder puro e verdade absoluta.'
    },
    'Dama da Noite': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/dama_noite.png',
      cores: 'Preto, Roxo, Azul-escuro',
      dia: 'Sexta-feira (noite)',
      lua: 'Lua Negra',
      signos: 'EscorpiÃ£o, Peixes',
      simbologia: 'Lua Crescente, Olho, Chave, Morcego',
      utensilio: 'Chave, Espelho Negro, Livro de Segredos',
      mensagem: 'Os mistÃ©rios do universo sussurram em seus ouvidos! Dama da Noite te revela o oculto. VocÃª enxerga alÃ©m do vÃ©u e guarda segredos profundos.'
    },
    'Sete Saias': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/sete_saias.png',
      cores: 'Multicolorido (Vermelho, Rosa, Amarelo)',
      dia: 'Quinta ou Domingo',
      lua: 'Lua Crescente ou Cheia',
      signos: 'SagitÃ¡rio, LeÃ£o',
      simbologia: 'Saias Coloridas, Tambor, MÃ¡scara',
      utensilio: 'Tambor, Leque, Fitas Coloridas',
      mensagem: 'Alegria Ã© sua essÃªncia! Sete Saias danÃ§a em sua vida trazendo movimento e paixÃ£o. VocÃª irradia vida, cor e intensidade contagiante.'
    },
    'Pombagira Cigana': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/cigana.png',
      cores: 'Vermelho, Dourado, Verde',
      dia: 'Quarta-feira',
      lua: 'Lua Cheia',
      signos: 'SagitÃ¡rio, Touro',
      simbologia: 'Carruagem, Cartas, Cristais, Rodas',
      utensilio: 'Baralho Cigano, Sinos, Moedas',
      mensagem: 'Liberdade corre em suas veias! Pombagira Cigana te abenÃ§oa com prosperidade e independÃªncia. VocÃª nÃ£o conhece correntes, apenas horizontes.'
    },
    'Maria Navalha': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/maria_navalha.png',
      cores: 'Preto, Vermelho, Prata',
      dia: 'TerÃ§a ou Sexta-feira (noite)',
      lua: 'Lua Minguante',
      signos: 'EscorpiÃ£o, GÃªmeos',
      simbologia: 'Navalha, Chave, Carta de Baralho',
      utensilio: 'Navalha, Dado, LenÃ§o Vermelho',
      mensagem: 'A malandragem Ã© sua sabedoria! Maria Navalha te protege nas ruas da vida. AstÃºcia, adaptaÃ§Ã£o e proteÃ§Ã£o sÃ£o suas companheiras fiÃ©is.'
    },
    'Pombagira da Praia': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/praia.png',
      cores: 'Azul, Branco, Prata',
      dia: 'Quinta ou Segunda-feira',
      lua: 'Lua Cheia ou Crescente',
      signos: 'CÃ¢ncer, Peixes',
      simbologia: 'Concha, Onda, PÃ©rola, Rede',
      utensilio: 'Concha, Jarro com Ãgua do Mar, Leque',
      mensagem: 'Suas emoÃ§Ãµes sÃ£o mar profundo! Pombagira da Praia te purifica e renova. VocÃª compreende as marÃ©s do coraÃ§Ã£o e traz calma aos tormentos.'
    },
    'Maria Farrapo': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/maria_farrapo.png',
      cores: 'Branco Sujo, Cinza, LilÃ¡s',
      dia: 'Segunda-feira',
      lua: 'Lua Minguante',
      signos: 'Virgem, Peixes',
      simbologia: 'Pano Rasgado, NÃ³, Labirinto',
      utensilio: 'Pano Branco, CordÃ£o com NÃ³s, Incenso de Lavanda',
      mensagem: 'VocÃª compreende o caos e dele tira ordem! Maria Farrapo te cura profundamente. Das ruÃ­nas mentais, vocÃª ergue clareza e sanidade.'
    },
    'Pombagira Menina': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/menina.png',
      cores: 'Rosa, Branco, Azul-claro',
      dia: 'Domingo',
      lua: 'Lua Nova',
      signos: 'Ãries, Libra',
      simbologia: 'Boneca, Flor, Borboleta, Sino',
      utensilio: 'Boneca, Sino, BalÃ£o',
      mensagem: 'RenovaÃ§Ã£o Ã© seu presente! Pombagira Menina te abenÃ§oa com recomeÃ§os. InocÃªncia e sabedoria ancestral se unem em vocÃª para trazer esperanÃ§a.'
    },
    'Pombagira da Figueira': {
      image: 'https://raw.githubusercontent.com/alexialuzdeferro/misterio-das-giras/refs/heads/main/figueira.png',
      cores: 'Marrom, Verde-escuro, Preto',
      dia: 'SÃ¡bado',
      lua: 'Lua Minguante',
      signos: 'Touro, CapricÃ³rnio',
      simbologia: 'RaÃ­zes, Ãrvore, Semente, Vasos de Barro',
      utensilio: 'Vaso de Barro, Sementes, Enxada',
      mensagem: 'Suas raÃ­zes sÃ£o profundas e fortes! Pombagira da Figueira te conecta aos ancestrais. VocÃª Ã© a ponte entre passado e presente, tradiÃ§Ã£o viva.'
    }
  };

  const questions = [
    {
      question: "Qual Pombagira Ã© sincretizada com a Rainha de SabÃ¡ e Maria Madalena?",
      options: ["Maria Mulambo", "Maria Padilha", "Sete Saias", "Pombagira Cigana"],
      correct: "Maria Padilha",
      pombagira: "Maria Padilha"
    },
    {
      question: "Qual entidade tem como utensÃ­lio principal o espelho negro e a chave?",
      options: ["Rosa Caveira", "Dama da Noite", "Maria Navalha", "Maria Farrapo"],
      correct: "Dama da Noite",
      pombagira: "Dama da Noite"
    },
    {
      question: "Em que fase da lua Maria Mulambo atua com maior poder de cura?",
      options: ["Lua Cheia", "Lua Nova", "Lua Minguante", "Lua Crescente"],
      correct: "Lua Minguante",
      pombagira: "Maria Mulambo"
    },
    {
      question: "Qual Pombagira Ã© invocada especificamente para batalhas espirituais e proteÃ§Ã£o guerreira?",
      options: ["Maria Padilha", "Maria QuitÃ©ria", "Maria Navalha", "Rosa Caveira"],
      correct: "Maria QuitÃ©ria",
      pombagira: "Maria QuitÃ©ria"
    },
    {
      question: "Que utensÃ­lio Ã© caracterÃ­stico de Rosa Caveira e simboliza transformaÃ§Ã£o?",
      options: ["Espada", "Foice", "Navalha", "Tridente"],
      correct: "Foice",
      pombagira: "Rosa Caveira"
    },
    {
      question: "Qual Ã© o dia propÃ­cio para reverenciar a Pombagira Cigana?",
      options: ["Segunda-feira", "TerÃ§a-feira", "Quarta-feira", "Sexta-feira"],
      correct: "Quarta-feira",
      pombagira: "Pombagira Cigana"
    },
    {
      question: "Quantas saias usa a Pombagira da alegria e intensidade?",
      options: ["TrÃªs", "Cinco", "Sete", "Nove"],
      correct: "Sete",
      pombagira: "Sete Saias"
    },
    {
      question: "Qual Pombagira tem como locais de oferenda hospitais psiquiÃ¡tricos e encruzilhadas silenciosas?",
      options: ["Maria Mulambo", "Maria Farrapo", "Pombagira Menina", "Pombagira da Praia"],
      correct: "Maria Farrapo",
      pombagira: "Maria Farrapo"
    },
    {
      question: "Que sÃ­mbolos sÃ£o associados Ã  Pombagira da Praia?",
      options: ["Caveira e rosa", "Concha e onda", "Navalha e dado", "Coroa e cetro"],
      correct: "Concha e onda",
      pombagira: "Pombagira da Praia"
    },
    {
      question: "Qual entidade trabalha com a energia de renovaÃ§Ã£o e inocÃªncia?",
      options: ["Maria Mulambo", "Pombagira Menina", "Sete Saias", "Maria Farrapo"],
      correct: "Pombagira Menina",
      pombagira: "Pombagira Menina"
    },
    {
      question: "Em que fase lunar a Dama da Noite atinge seu mistÃ©rio mÃ¡ximo?",
      options: ["Lua Cheia", "Lua Nova", "Lua Negra", "Lua Crescente"],
      correct: "Lua Negra",
      pombagira: "Dama da Noite"
    },
    {
      question: "Qual Pombagira Ã© associada aos signos de Touro e CapricÃ³rnio?",
      options: ["Maria Padilha", "Pombagira Cigana", "Pombagira da Figueira", "Maria QuitÃ©ria"],
      correct: "Pombagira da Figueira",
      pombagira: "Pombagira da Figueira"
    },
    {
      question: "Que cor NÃƒO Ã© tÃ­pica de Maria Navalha?",
      options: ["Preto", "Vermelho", "Prata", "Dourado"],
      correct: "Dourado",
      pombagira: "Maria Navalha"
    },
    {
      question: "Qual entidade tem como simbologia principal raÃ­zes, Ã¡rvore e sementes?",
      options: ["Maria Mulambo", "Pombagira da Figueira", "Maria Farrapo", "Pombagira da Praia"],
      correct: "Pombagira da Figueira",
      pombagira: "Pombagira da Figueira"
    },
    {
      question: "Qual Pombagira trabalha especificamente com cemitÃ©rios e energia de justiÃ§a implacÃ¡vel?",
      options: ["Dama da Noite", "Rosa Caveira", "Maria QuitÃ©ria", "Maria Navalha"],
      correct: "Rosa Caveira",
      pombagira: "Rosa Caveira"
    }
  ];

  const playSound = (isCorrect) => {
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    oscillator.frequency.value = isCorrect ? 800 : 400;
    oscillator.type = 'sine';
    
    gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
    
    oscillator.start(audioContext.currentTime);
    oscillator.stop(audioContext.currentTime + 0.3);
  };

  const handleAnswer = (answer) => {
    const correct = answer === questions[currentQuestion].correct;
    setSelectedAnswer(answer);
    setIsCorrect(correct);
    playSound(correct);

    if (correct) {
      const pombagiraName = questions[currentQuestion].pombagira;
      setScore(prev => ({
        ...prev,
        [pombagiraName]: (prev[pombagiraName] || 0) + 1
      }));
    }

    setTimeout(() => {
      if (currentQuestion < questions.length - 1) {
        setCurrentQuestion(currentQuestion + 1);
        setSelectedAnswer(null);
        setIsCorrect(null);
        setAnsweredQuestions(answeredQuestions + 1);
      } else {
        setShowResult(true);
      }
    }, 1500);
  };

  const getQueenPombagira = () => {
    let maxScore = 0;
    let queen = 'Maria Padilha';
    
    Object.entries(score).forEach(([name, points]) => {
      if (points > maxScore) {
        maxScore = points;
        queen = name;
      }
    });
    
    return queen;
  };

  if (showResult) {
    const queen = getQueenPombagira();
    const queenData = pombagiras[queen];

    return (
      <div className="min-h-screen bg-gradient-to-br from-purple-900 via-red-900 to-black p-4 flex items-center justify-center">
        <div className="max-w-2xl w-full">
          <div className="bg-gradient-to-br from-purple-800/40 to-red-800/40 backdrop-blur-lg rounded-3xl shadow-2xl border-2 border-yellow-500/50 p-8 animate-pulse-slow">
            <div className="flex justify-center mb-6">
              <Crown className="w-16 h-16 text-yellow-400 animate-bounce" />
            </div>
            
            <h1 className="text-4xl font-bold text-center text-yellow-400 mb-4 drop-shadow-lg">
              Sua Pombagira Rainha!
            </h1>
            
            <div className="bg-black/50 rounded-2xl p-6 mb-6 border-2 border-red-500/50">
              <img 
                src={queenData.image} 
                alt={queen}
                className="w-full h-64 object-contain mb-4 drop-shadow-2xl"
              />
              <h2 className="text-3xl font-bold text-center text-red-400 mb-4">
                {queen}
              </h2>
            </div>

            <div className="space-y-4 bg-black/30 rounded-xl p-6 border border-yellow-500/30">
              <div className="flex items-start gap-3">
                <Flame className="w-6 h-6 text-red-400 flex-shrink-0 mt-1" />
                <div>
                  <p className="text-yellow-300 font-semibold">Cores:</p>
                  <p className="text-white">{queenData.cores}</p>
                </div>
              </div>

              <div className="flex items-start gap-3">
                <Moon className="w-6 h-6 text-purple-400 flex-shrink-0 mt-1" />
                <div>
                  <p className="text-yellow-300 font-semibold">Lua:</p>
                  <p className="text-white">{queenData.lua}</p>
                </div>
              </div>

              <div className="flex items-start gap-3">
                <Star className="w-6 h-6 text-yellow-400 flex-shrink-0 mt-1" />
                <div>
                  <p className="text-yellow-300 font-semibold">Dia PropÃ­cio:</p>
                  <p className="text-white">{queenData.dia}</p>
                </div>
              </div>

              <div className="flex items-start gap-3">
                <Sparkles className="w-6 h-6 text-blue-400 flex-shrink-0 mt-1" />
                <div>
                  <p className="text-yellow-300 font-semibold">Signos:</p>
                  <p className="text-white">{queenData.signos}</p>
                </div>
              </div>

              <div className="flex items-start gap-3">
                <Crown className="w-6 h-6 text-yellow-400 flex-shrink-0 mt-1" />
                <div>
                  <p className="text-yellow-300 font-semibold">Simbologia:</p>
                  <p className="text-white">{queenData.simbologia}</p>
                </div>
              </div>

              <div className="flex items-start gap-3">
                <Sword className="w-6 h-6 text-red-400 flex-shrink-0 mt-1" />
                <div>
                  <p className="text-yellow-300 font-semibold">UtensÃ­lios:</p>
                  <p className="text-white">{queenData.utensilio}</p>
                </div>
              </div>
            </div>

            <div className="mt-6 bg-gradient-to-r from-red-900/50 to-purple-900/50 rounded-xl p-6 border-2 border-yellow-400/50">
              <Heart className="w-8 h-8 text-red-400 mx-auto mb-3" />
              <p className="text-white text-center italic leading-relaxed">
                {queenData.mensagem}
              </p>
            </div>

            <div className="mt-6 text-center">
              <p className="text-yellow-300 text-lg font-semibold mb-2">
                VocÃª acertou {Object.values(score).reduce((a, b) => a + b, 0)} de 15 perguntas
              </p>
              <button
                onClick={() => window.location.reload()}
                className="bg-gradient-to-r from-red-600 to-purple-600 text-white px-8 py-3 rounded-full font-bold hover:scale-105 transition-transform shadow-lg"
              >
                Refazer Quiz
              </button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-red-900 p-4 flex items-center justify-center">
      <div className="max-w-3xl w-full">
        <div className="bg-gradient-to-br from-purple-800/30 to-red-800/30 backdrop-blur-md rounded-3xl shadow-2xl border border-purple-500/50 overflow-hidden">
          
          {/* Header */}
          <div className="bg-gradient-to-r from-red-600 to-purple-600 p-6 relative overflow-hidden">
            <div className="absolute inset-0 bg-black/20"></div>
            <div className="relative z-10">
              <div className="flex justify-between items-center mb-4">
                <div className="flex items-center gap-2">
                  <Flame className="w-6 h-6 text-yellow-400 animate-pulse" />
                  <span className="text-white font-bold text-lg">
                    Pergunta {currentQuestion + 1}/{questions.length}
                  </span>
                </div>
                <div className="flex items-center gap-2">
                  <Crown className="w-6 h-6 text-yellow-400" />
                  <span className="text-white font-bold">
                    {answeredQuestions} acertos
                  </span>
                </div>
              </div>
              
              <div className="bg-white/20 rounded-full h-3 overflow-hidden">
                <div 
                  className="bg-gradient-to-r from-yellow-400 to-red-400 h-full transition-all duration-500 ease-out"
                  style={{width: `${((currentQuestion + 1) / questions.length) * 100}%`}}
                ></div>
              </div>
            </div>
          </div>

          {/* Question */}
          <div className="p-8">
            <div className="bg-black/40 rounded-2xl p-6 mb-8 border-2 border-purple-500/50 shadow-xl">
              <div className="flex justify-center mb-4">
                <Sparkles className="w-10 h-10 text-yellow-400 animate-spin-slow" />
              </div>
              <h2 className="text-2xl md:text-3xl font-bold text-white text-center leading-relaxed">
                {questions[currentQuestion].question}
              </h2>
            </div>

            {/* Options */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              {questions[currentQuestion].options.map((option, index) => {
                let bgColor = 'bg-gradient-to-r from-purple-600/50 to-red-600/50 hover:from-purple-500/70 hover:to-red-500/70';
                let borderColor = 'border-purple-400/50';
                let transform = 'hover:scale-105';

                if (selectedAnswer === option) {
                  if (isCorrect) {
                    bgColor = 'bg-gradient-to-r from-green-500 to-emerald-600 animate-pulse';
                    borderColor = 'border-green-400';
                    transform = 'scale-105';
                  } else {
                    bgColor = 'bg-gradient-to-r from-red-600 to-red-800 animate-shake';
                    borderColor = 'border-red-400';
                    transform = 'scale-95';
                  }
                }

                if (selectedAnswer && option === questions[currentQuestion].correct && !isCorrect) {
                  bgColor = 'bg-gradient-to-r from-green-500 to-emerald-600';
                  borderColor = 'border-green-400';
                }

                return (
                  <button
                    key={index}
                    onClick={() => !selectedAnswer && handleAnswer(option)}
                    disabled={selectedAnswer !== null}
                    className={`${bgColor} ${transform} border-2 ${borderColor} text-white px-6 py-4 rounded-xl font-semibold text-lg transition-all duration-300 shadow-lg disabled:cursor-not-allowed backdrop-blur-sm`}
                  >
                    {option}
                  </button>
                );
              })}
            </div>

            {selectedAnswer && (
              <div className="mt-6 text-center">
                <div className={`inline-flex items-center gap-2 px-6 py-3 rounded-full ${isCorrect ? 'bg-green-500/30' : 'bg-red-500/30'} border-2 ${isCorrect ? 'border-green-400' : 'border-red-400'}`}>
                  {isCorrect ? (
                    <>
                      <Sparkles className="w-6 h-6 text-green-400 animate-spin" />
                      <span className="text-green-200 font-bold text-xl">Correto! âœ¨</span>
                    </>
                  ) : (
                    <>
                      <Flame className="w-6 h-6 text-red-400" />
                      <span className="text-red-200 font-bold text-xl">Incorreto! ðŸ”¥</span>
                    </>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>

        {/* Decorative Elements */}
        <div className="mt-6 text-center">
          <p className="text-yellow-300 text-sm font-semibold flex items-center justify-center gap-2">
            <Moon className="w-5 h-5 animate-pulse" />
            Descubra qual Pombagira reina em seu caminho
            <Star className="w-5 h-5 animate-pulse" />
          </p>
        </div>
      </div>

      <style jsx>{`
        @keyframes spin-slow {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
        .animate-spin-slow {
          animation: spin-slow 3s linear infinite;
        }
        @keyframes shake {
          0%, 100% { transform: translateX(0); }
          25% { transform: translateX(-10px); }
          75% { transform: translateX(10px); }
        }
        .animate-shake {
          animation: shake 0.5s ease-in-out;
        }
        @keyframes pulse-slow {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.9; transform: scale(1.02); }
        }
        .animate-pulse-slow {
          animation: pulse-slow 3s ease-in-out infinite;
        }
      `}</style>
    </div>
  );
};

export default PombagiraQuiz;
